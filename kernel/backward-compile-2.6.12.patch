Index: iscsi_tcp.c
===================================================================
--- iscsi_tcp.c	(revision 371)
+++ iscsi_tcp.c	(working copy)
@@ -2530,14 +2530,17 @@
 	struct iscsi_conn *conn = ctask->conn;
 	struct iscsi_session *session = conn->session;
 
+	spin_unlock_irq(session->host->host_lock);
 	spin_lock_bh(&session->lock);
 	if (session->state == ISCSI_STATE_TERMINATE) {
 		debug_scsi("failing host reset: session terminated "
 			   "[CID %d age %d]", conn->id, session->age);
 		spin_unlock_bh(&session->lock);
+		spin_lock_irq(session->host->host_lock);
 		return FAILED;
 	}
 	spin_unlock_bh(&session->lock);
+	spin_lock_irq(session->host->host_lock);
 
 	debug_scsi("failing connection CID %d due to SCSI host reset "
 		   "[itt 0x%x age %d]", conn->id, ctask->itt,
@@ -2575,6 +2578,7 @@
 	struct iscsi_conn *conn = ctask->conn;
 	struct iscsi_session *session = conn->session;
 
+	spin_unlock_irq(session->host->host_lock);
 	conn->eh_abort_cnt++;
 	debug_scsi("aborting [sc %lx itt 0x%x]\n", (long)sc, ctask->itt);
 
@@ -2746,6 +2750,7 @@
 		write_unlock_bh(&sk->sk_callback_lock);
 	}
 	up(&conn->xmitsema);
+	spin_lock_irq(session->host->host_lock);
 	return rc;
 }
 
Index: scsi_transport_iscsi.c
===================================================================
--- scsi_transport_iscsi.c	(revision 371)
+++ scsi_transport_iscsi.c	(working copy)
@@ -354,7 +354,7 @@
 		return -ENOMEM;
 	}
 
-	nlh = __nlmsg_put(skb, daemon_pid, 0, 0, (len - sizeof(*nlh)), 0);
+	nlh = __nlmsg_put(skb, daemon_pid, 0, 0, (len - sizeof(*nlh)));
 	ev = NLMSG_DATA(nlh);
 	memset(ev, 0, sizeof(*ev));
 	ev->transport_handle = iscsi_handle(conn->transport);
@@ -390,7 +390,7 @@
 		return;
 	}
 
-	nlh = __nlmsg_put(skb, daemon_pid, 0, 0, (len - sizeof(*nlh)), 0);
+	nlh = __nlmsg_put(skb, daemon_pid, 0, 0, (len - sizeof(*nlh)));
 	ev = NLMSG_DATA(nlh);
 	ev->transport_handle = iscsi_handle(conn->transport);
 	ev->type = ISCSI_KEVENT_CONN_ERROR;
@@ -426,7 +426,7 @@
 	 */
 	BUG_ON(!skb);
 
-	nlh = __nlmsg_put(skb, pid, seq, t, (len - sizeof(*nlh)), 0);
+	nlh = __nlmsg_put(skb, pid, seq, t, (len - sizeof(*nlh)));
 	nlh->nlmsg_flags = flags;
 	memcpy(NLMSG_DATA(nlh), payload, size);
 	return iscsi_unicast_skb(&z_reply, skb);
@@ -762,7 +762,7 @@
 		}
 
 		nlhstat = __nlmsg_put(skbstat, daemon_pid, 0, 0,
-				      (len - sizeof(*nlhstat)), 0);
+				      (len - sizeof(*nlhstat)));
 		evstat = NLMSG_DATA(nlhstat);
 		memset(evstat, 0, sizeof(*evstat));
 		evstat->transport_handle = iscsi_handle(conn->transport);
